<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">

<head>
  <title>Dynamic import ä»‹ç» | KBScript</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="KBScript">
    <meta name="author" content="MrKou47">
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">
    <link rel="alternate" href="/atom.xml" title="KBScript" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
    
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    

    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->

  
  
  <link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="atom.xml">
  
  

  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close">
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            <li>
                <a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                        <li><a href="https://github.com/MrKou47/wechat-pay-sdk" target="_BLANK" class="animsition-link">wechatPaySDK</a></li>
                    
                        <li><a href="https://github.com/MrKou47/qiyu-sdk" target="_BLANK" class="animsition-link">qiyuSDK</a></li>
                    
                        <li><a href="https://github.com/MrKou47/jest-css-modules-processor" target="_BLANK" class="animsition-link">jest-css-modules-processor</a></li>
                    
                        <li><a href="https://github.com/MrKou47/thrift-syntax-support" target="_BLANK" class="animsition-link">thrift-syntax-support</a></li>
                    
                </ul>
            </li>
            
            <!-- 
        	<li>
        		<a class="sb-toggle-submenu">Categories<span class="sb-caret"></span></a>
            	<ul class="sb-submenu">
				  	
				    <li><a href="/categories/æŠ€æœ¯/" class="animsition-link">æŠ€æœ¯<small>(9)</small></a></li>
				    
				    <li><a href="/categories/çå†™ä»€ä¹ˆ/" class="animsition-link">çå†™ä»€ä¹ˆ<small>(1)</small></a></li>
				    
				</ul>
        	</li>
			 -->
            
        	<li>
        		<a class="sb-toggle-submenu">Tags<span class="sb-caret"></span></a>
            	<ul class="sb-submenu">
				  	
				    <li><a href="/tags/World-of-Warcraft/" class="animsition-link">World of Warcraft<small>(1)</small></a></li>
				    
				    <li><a href="/tags/babel/" class="animsition-link">babel<small>(1)</small></a></li>
				    
				    <li><a href="/tags/express/" class="animsition-link">express<small>(2)</small></a></li>
				    
				    <li><a href="/tags/hexo/" class="animsition-link">hexo<small>(1)</small></a></li>
				    
				    <li><a href="/tags/javascript/" class="animsition-link">javascript<small>(4)</small></a></li>
				    
				    <li><a href="/tags/other/" class="animsition-link">other<small>(1)</small></a></li>
				    
				    <li><a href="/tags/react/" class="animsition-link">react<small>(1)</small></a></li>
				    
				    <li><a href="/tags/react-webpack/" class="animsition-link">react webpack<small>(0)</small></a></li>
				    
				    <li><a href="/tags/typescript/" class="animsition-link">typescript<small>(4)</small></a></li>
				    
				    <li><a href="/tags/webpack/" class="animsition-link">webpack<small>(3)</small></a></li>
				    
				    <li><a href="/tags/æ•°æ®ç»“æ„/" class="animsition-link">æ•°æ®ç»“æ„<small>(1)</small></a></li>
				    
				    <li><a href="/tags/ç¼–è¯‘ç›¸å…³/" class="animsition-link">ç¼–è¯‘ç›¸å…³<small>(1)</small></a></li>
				    
				    <li><a href="/tags/è®¾è®¡æ¨¡å¼/" class="animsition-link">è®¾è®¡æ¨¡å¼<small>(1)</small></a></li>
				    
				</ul>
        	</li>
			
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                        
                            <!-- <img src="/img/logo.svg" alt="Logo" width="120px;"/> -->
                            <svg class="site-logo" xmlns="http://www.w3.org/2000/svg" version="1.0" viewbox="0 0 900.000000 210.000000" preserveaspectratio="xMidYMid meet" style="&#10;    width: 100px;&#10;">
                                <g transform="translate(0.000000,210.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none">
                                <path d="M6770 1961 c-31 -26 -35 -34 -34 -77 1 -40 6 -52 33 -76 67 -60 171 -13 171 77 0 41 -26 82 -61 94 -49 17 -72 13 -109 -18z"/>
                                <path d="M4155 1945 c-145 -26 -246 -100 -302 -223 -34 -74 -36 -204 -5 -272 47 -103 105 -155 307 -274 72 -42 137 -81 145 -86 8 -6 26 -15 39 -20 14 -6 55 -31 92 -55 107 -72 144 -135 137 -234 -7 -103 -66 -166 -189 -204 -31 -9 -69 -17 -85 -17 -70 1 -208 51 -269 98 -57 43 -135 187 -135 247 0 37 -11 55 -31 55 -19 0 -19 -9 -17 -232 3 -193 5 -233 17 -233 8 0 22 14 31 30 22 40 64 43 160 9 41 -14 114 -33 162 -42 74 -14 98 -14 170 -3 229 35 378 189 378 392 0 92 -29 163 -97 239 -57 63 -128 109 -329 215 -238 126 -296 170 -329 247 -35 85 -7 168 80 234 69 53 142 65 238 40 78 -20 133 -51 183 -102 45 -47 104 -158 104 -198 0 -42 21 -86 41 -86 18 0 19 11 19 229 0 126 -3 236 -6 245 -8 21 -30 9 -53 -30 -18 -30 -25 -34 -64 -34 -23 0 -47 4 -52 8 -17 15 -129 50 -180 57 -27 4 -59 8 -70 10 -11 1 -51 -3 -90 -10z"/>
                                <path d="M207 1906 c-8 -21 2 -26 52 -26 59 0 109 -27 133 -71 17 -31 18 -70 18 -599 0 -530 -2 -568 -19 -606 -24 -54 -55 -74 -111 -74 -47 0 -80 -13 -66 -27 12 -13 156 -21 368 -22 202 -1 228 2 228 24 0 16 -22 25 -61 25 -36 0 -86 24 -111 54 -16 19 -17 48 -18 304 0 155 3 282 8 282 15 0 40 -24 287 -269 139 -138 258 -265 265 -282 12 -28 11 -32 -15 -59 -19 -19 -39 -30 -57 -30 -21 0 -28 -5 -28 -19 0 -10 7 -22 16 -25 9 -3 140 -6 293 -6 217 0 281 3 296 13 25 19 13 33 -36 41 -80 13 -179 68 -254 142 -198 195 -559 582 -563 603 -3 20 463 485 520 518 38 22 38 22 48 2 8 -13 11 -158 10 -437 -1 -229 -1 -424 0 -432 1 -21 24 11 58 79 42 85 174 211 305 290 20 12 37 24 37 25 0 2 -9 29 -21 62 -35 101 -59 197 -59 243 0 85 47 211 94 250 9 7 16 20 16 27 0 12 -64 14 -397 12 -346 -3 -398 -5 -398 -18 0 -10 14 -17 42 -21 56 -7 73 -24 73 -69 0 -33 -10 -49 -74 -121 -135 -153 -441 -443 -457 -433 -5 3 -9 126 -9 273 0 256 1 269 21 295 29 37 56 50 119 56 40 4 55 9 55 20 0 22 -600 28 -608 6z"/>
                                <path d="M2275 1910 c-4 -6 0 -19 8 -28 49 -55 62 -185 27 -267 -27 -62 -114 -152 -205 -211 -49 -31 -75 -54 -75 -66 0 -17 18 -53 95 -193 15 -27 34 -57 41 -66 8 -8 14 -19 14 -24 0 -10 71 -117 84 -127 16 -11 30 1 60 50 76 120 115 222 116 300 0 52 -12 79 -53 113 -49 42 -31 49 119 49 114 0 136 -2 141 -16 4 -10 -4 -24 -20 -37 -14 -12 -57 -87 -96 -167 -38 -80 -99 -190 -134 -246 -35 -55 -66 -108 -70 -118 -10 -26 111 -149 180 -182 103 -51 201 -18 275 90 l33 49 3 171 c3 214 -2 206 149 206 279 0 450 -97 482 -273 23 -125 -33 -243 -142 -298 -74 -38 -159 -59 -244 -59 -91 0 -223 24 -235 43 -4 7 -8 31 -8 55 0 55 -18 55 -48 -2 -27 -51 -52 -76 -118 -120 -85 -56 -83 -56 213 -56 369 0 539 20 633 73 58 33 140 119 166 173 40 85 49 150 30 225 -29 113 -81 173 -193 226 -77 36 -91 57 -48 73 71 27 143 112 169 199 20 67 20 104 2 174 -34 129 -133 220 -293 269 -64 20 -95 21 -559 25 -366 4 -493 2 -499 -7z m871 -76 c81 -20 129 -45 181 -95 86 -82 110 -212 57 -317 -61 -122 -196 -173 -426 -159 -151 9 -138 -17 -138 286 0 287 -2 278 68 292 66 12 194 9 258 -7z"/>
                                <path d="M1983 1889 c-18 -11 -43 -37 -55 -57 -32 -51 -32 -198 0 -289 46 -131 56 -136 131 -76 108 86 151 159 151 258 0 80 -24 134 -73 164 -45 27 -111 27 -154 0z"/>
                                <path d="M8461 1707 c-44 -94 -117 -184 -193 -240 -83 -60 -79 -78 14 -76 42 1 63 -3 69 -12 5 -8 9 -178 9 -379 0 -409 -1 -405 72 -463 76 -61 178 -46 262 40 32 33 76 100 76 118 0 16 -42 2 -51 -18 -13 -30 -63 -57 -103 -57 -44 0 -71 32 -85 100 -13 66 -13 622 -1 656 9 22 15 23 112 26 102 3 103 3 103 28 0 25 -1 25 -103 28 -101 3 -103 3 -113 30 -6 14 -9 79 -8 143 3 161 -12 180 -60 76z"/>
                                <path d="M5232 1459 c-175 -75 -284 -255 -285 -469 -2 -316 206 -537 465 -495 149 25 262 138 323 323 9 29 14 56 11 60 -11 11 -39 -13 -61 -51 -111 -199 -317 -236 -452 -83 -79 89 -113 190 -113 331 0 188 65 301 196 341 97 29 194 -33 194 -125 0 -42 33 -97 63 -105 84 -22 147 10 147 75 0 77 -53 146 -150 195 -48 25 -69 29 -160 31 -99 3 -109 2 -178 -28z"/>
                                <path d="M6060 1474 c-46 -21 -82 -36 -155 -66 -44 -18 -60 -30 -60 -44 0 -16 6 -19 47 -16 41 3 51 0 73 -24 l25 -27 0 -329 c0 -274 -3 -334 -15 -358 -19 -36 -43 -50 -89 -50 -38 0 -49 -9 -37 -28 6 -9 64 -12 237 -10 194 3 229 5 229 18 0 9 -13 17 -35 20 -47 8 -74 24 -94 55 -15 22 -17 61 -17 311 0 245 2 289 15 303 9 10 16 22 16 27 0 13 63 79 83 87 19 7 43 -1 102 -38 49 -30 84 -31 118 -5 53 42 44 132 -18 170 -52 32 -122 27 -176 -12 -24 -17 -50 -40 -58 -51 -8 -11 -22 -27 -33 -36 -10 -8 -18 -21 -18 -28 0 -17 -29 -17 -32 0 -1 6 -2 41 -3 77 l0 65 -35 2 c-19 1 -51 -5 -70 -13z"/>
                                <path d="M6825 1475 c-76 -34 -205 -85 -215 -85 -6 0 -10 -10 -8 -22 3 -21 8 -23 53 -20 42 3 54 0 70 -18 19 -21 20 -38 20 -349 0 -179 -3 -337 -8 -351 -13 -44 -35 -63 -79 -69 -29 -4 -43 -11 -43 -21 0 -13 33 -15 223 -18 217 -2 222 -2 222 18 0 16 -7 20 -37 20 -45 1 -64 13 -86 57 -15 28 -17 81 -17 453 l0 420 -32 -1 c-18 0 -46 -6 -63 -14z"/>
                                <path d="M7330 1460 c-36 -15 -90 -38 -120 -50 -63 -25 -80 -37 -80 -55 0 -9 17 -12 55 -11 61 1 68 -4 85 -64 13 -47 13 -1043 0 -1091 -13 -48 -46 -75 -98 -82 -50 -6 -57 -10 -49 -32 6 -13 39 -15 242 -15 l236 0 -3 23 c-2 18 -11 23 -51 27 -30 4 -55 14 -70 28 -21 21 -22 32 -25 196 -3 118 0 181 8 195 l11 22 32 -23 c18 -13 61 -27 98 -34 153 -26 297 31 389 153 202 267 136 720 -121 824 -55 22 -167 24 -215 4 -51 -21 -109 -69 -146 -121 -41 -57 -51 -47 -58 54 -5 73 -6 77 -30 79 -14 1 -54 -11 -90 -27z m442 -152 c53 -36 92 -93 122 -176 17 -48 20 -80 20 -207 0 -140 -2 -154 -26 -206 -54 -116 -117 -163 -218 -163 -81 0 -140 29 -185 92 l-30 44 -3 254 -4 254 44 41 c113 107 193 126 280 67z"/>
                                <path d="M1805 1228 c-32 -17 -104 -89 -135 -135 -83 -122 -78 -288 12 -397 45 -55 94 -76 177 -76 82 0 142 26 217 94 l48 43 -49 79 c-27 43 -64 102 -83 129 -18 28 -58 101 -89 163 -31 61 -61 112 -67 112 -6 0 -20 -6 -31 -12z"/>
                                <path d="M2148 671 c-6 -17 -113 -102 -165 -132 -95 -55 -82 -59 180 -59 127 0 238 4 245 8 15 10 -4 29 -53 52 -16 8 -59 43 -96 78 -60 56 -102 76 -111 53z"/>
                                </g>
                            </svg>
                        
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">KBScript</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/MrKou47" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            <li><a href="https://twitter.com/mrkou47" title="Twitter" target="_blank"><i class="icon-twitter"></i></a></li>
                            
                            
                            
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->

</div>
      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2018-03-27T12:19:41.000Z" itemprop="datePublished">
          2018-03-27
      </time>
    
    
    | 
    <a href="/tags/babel/">babel</a>,
    
    <a href="/tags/ç¼–è¯‘ç›¸å…³/">ç¼–è¯‘ç›¸å…³</a>
    
    
</span>
                <h1 style="word-wrap: break-word;line-height: 1.2;">Dynamic import ä»‹ç»</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Dynamic importç›¸å¯¹äº static importæä¾›äº†ä¸€ç§æ–°çš„ <em>function-lick</em> çš„å½¢å¼æ¥å®ç° <em>import</em>ã€‚è¿™ç¯‡æ–‡ç« é€šè¿‡ä»‹ç»è¿™ä¸¤ç§ <em>import</em> çš„æ–¹å¼æ¥è§£é‡Šä¸¤è€…çš„å·®å¼‚ï¼ŒåŒæ—¶ä¹Ÿæ ¹æ® <em>babel</em> æ¥å­¦ä¹ ä¸€ä¸‹ babel å¯¹äºæ­¤æ–°è¯­æ³•çš„å¤„ç†ã€‚</p>
<a id="more"></a>
<h2 id="Static-import"><a href="#Static-import" class="headerlink" title="Static import"></a>Static import</h2><p>æ—©åœ¨å»å¹´ä¹æœˆ(2017.09)ï¼Œchrome 61å¼€å§‹æ”¯æŒåœ¨æ¨¡å—ç³»ç»Ÿä¸­ä½¿ç”¨ <em>es2015</em> çš„ <em>import</em> è¯­æ³•ã€‚</p>
<p>è§‚å¯Ÿä¸‹é¢çš„ <code>./utils.mjs</code> æ¨¡å—ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Default export</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Hi from the default export!'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Named export `doStuff`</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> doStuff = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Doing stuffâ€¦'</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>import Utils, { doStuff } from &#39;./utils.mjs&#39;;</code> æ¥è°ƒç”¨æ­¤æ¨¡å—ã€‚å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> * <span class="keyword">as</span> <span class="built_in">module</span> <span class="keyword">from</span> <span class="string">'./utils.mjs'</span>;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">module</span>.default();</span></span><br><span class="line"><span class="javascript">  <span class="comment">// â†’ logs 'Hi from the default export!'</span></span></span><br><span class="line"><span class="javascript">  <span class="built_in">module</span>.doStuff();</span></span><br><span class="line"><span class="javascript">  <span class="comment">// â†’ logs 'Doing stuffâ€¦'</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>ğŸŒŸ æ³¨æ„: ä¸Šé¢çš„æ —å­ä½¿ç”¨<code>.mjs</code>ä½œä¸ºæ‹“å±•åæ¥æ ‡ç¤ºè¿™æ˜¯ä¸€ä¸ªæ¨¡å—è€Œä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„scriptè„šæœ¬ã€‚åœ¨æµè§ˆå™¨ä¸Šï¼Œæ–‡ä»¶çš„æ‹“å±•åå¹¶ä¸æ˜¯å¾ˆæœ‰ç”¨ï¼Œè¿™å®Œå…¨å–å†³äºè¯·æ±‚èµ„æºçš„ Content-typeä¸­å®šä¹‰çš„æ–‡ä»¶ MIME type(æ¯”å¦‚jsæ–‡ä»¶çš„ text/javascript)ã€‚.mjs æ‰©å±•ååœ¨è¯¸å¦‚ Node.js ä¹‹ç±»çš„å…¶ä»–å¹³å°ä¸Šç‰¹åˆ«æœ‰ç”¨ï¼Œå…¶ä¸­æ²¡æœ‰ mime ç±»å‹æˆ–å…¶ä»–é’©å­çš„æ¦‚å¿µï¼Œä¾‹å¦‚ type =â€œmoduleâ€ æ¥ç¡®å®šæŸäº‹æ˜¯æ¨¡å—è¿˜æ˜¯æ™®é€šè„šæœ¬ã€‚<br>æˆ‘ä»¬åœ¨æ­¤ä½¿ç”¨ç›¸åŒçš„æ‰©å±•æ¥å®ç°è·¨å¹³å°çš„ä¸€è‡´æ€§ï¼Œå¹¶æ˜ç¡®åŒºåˆ†æ¨¡å—å’Œå¸¸è§„è„šæœ¬ã€‚</p>
</blockquote>
<p>è¿™ç§å¼•å…¥æ¨¡å—çš„è¯­æ³•å½¢å¼æ˜¯ <strong>static</strong> declarationã€‚å®ƒåªæ¥æ”¶å­—ç¬¦ä¸²æ¥å½“ä½œæ¨¡å—æ ‡ç¤ºç¬¦ã€‚å¹¶åœ¨ä»£ç è¿è¡Œå‰è°ƒç”¨ä¸€ä¸ª <em>link process</em> æ¥å°†æ¨¡å—ç»‘å®šåˆ°æœ¬åœ°ä½œç”¨åŸŸã€‚é™æ€ <code>import</code> è¯­æ³•åªèƒ½åœ¨æ–‡ä»¶é¡¶å±‚ä½¿ç”¨ã€‚é™æ€ <code>import</code> è®©ä¸€äº›é‡è¦çš„ use case å¾—ä»¥å®ç°ï¼Œè¯¸å¦‚ é™æ€åˆ†æï¼Œç»‘å®šå·¥å…·ï¼Œå’Œæ ‘çŠ¶ç»“æ„ã€‚</p>
<p>ä½†æ˜¯åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>æŒ‰éœ€åŠ è½½ï¼ˆæˆ–åœ¨æŒ‡å®šæƒ…å†µä¸‹åŠ è½½ä»£ç ï¼‰</li>
<li>åœ¨ runtime ä¸­è®¡ç®—æ¨¡å—æ ‡ç¤ºç¬¦</li>
<li>ä»å¸¸è§„è„šæœ¬ä¸­åŠ è½½æ¨¡å—ï¼ˆè€Œä¸æ˜¯æ¨¡å—æ–‡ä»¶ï¼‰</li>
</ul>
<p><strong>static</strong> import å°±ä¸èƒ½å®ç°äº†ã€‚</p>
<h2 id="Dynamic-import-ğŸ”¥"><a href="#Dynamic-import-ğŸ”¥" class="headerlink" title="Dynamic import ğŸ”¥"></a>Dynamic import ğŸ”¥</h2><p><strong>Dynamic</strong> <code>import</code> æä¾›äº†ä¸€ç§ <em>function-like</em> importæ¨¡å¼å®ç°ä»¥ä¸Šcaseã€‚<code>import(moduleSpecifier)</code>ä¸ºæ‰€è¯·æ±‚çš„æ¨¡å—è¿”å›ä¸€ä¸ªå¸¦æœ‰æ¨¡å—å‘½åç©ºé—´å¯¹è±¡çš„ <em>Promise</em>ã€‚å®ƒæ˜¯åœ¨è·å–ï¼Œå®ä¾‹åŒ–æ¨¡å—ä¾èµ–ä»¥åŠæ¨¡å—æœ¬èº«ä¹‹ååˆ›å»ºçš„ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªåŠ¨æ€å¼•å…¥æ¨¡å—çš„æ —å­ï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> moduleSpecifier = <span class="string">'./utils.mjs'</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span>(moduleSpecifier)</span></span><br><span class="line"><span class="javascript">    .then(<span class="function">(<span class="params"><span class="built_in">module</span></span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">module</span>.default();</span></span><br><span class="line"><span class="javascript">      <span class="comment">// â†’ logs 'Hi from the default export!'</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">module</span>.doStuff();</span></span><br><span class="line"><span class="javascript">      <span class="comment">// â†’ logs 'Doing stuffâ€¦'</span></span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>æ³¨æ„: è™½ç„¶ import() åƒæ˜¯ä¸€ä¸ª <em>function call</em>ï¼Œä½†å®é™…ä¸Šå®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è¯­æ³•æ ‡ç¤ºï¼Œç±»ä¼¼ä¸ <code>super()</code>, éƒ½æ˜¯ä½¿ç”¨æ‹¬å·çš„è¯­æ³•æ ‡ç¤ºã€‚è¿™ä¹Ÿå°±æ„å‘³ <code>import</code> å¹¶ä¸ç»§æ‰¿è‡ª <code>Function.prototype</code>ï¼Œæ‰€ä»¥ä½ ä¸èƒ½åœ¨ <code>import</code> ä¸Šä½¿ç”¨ <code>call</code> æˆ–è€… <code>apply</code>ã€‚åŒæ—¶ç±»ä¼¼äº <code>const importAlias = import</code> è¿™æ ·çš„å£°æ˜è¯­å¥åŒæ ·ä¹Ÿä¸ä¼šæœ‰æ•ˆæœâ€”â€”â€”â€” <code>import</code> ä»ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡</p>
</blockquote>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªåœ¨å•é¡µåº”ç”¨ä¸­åˆ©ç”¨ <code>import</code> å®ç° <em>lazy-load</em> çš„ä¸€ä¸ªæ —å­ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>My library<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">nav</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"books.html"</span> <span class="attr">data-entry-module</span>=<span class="string">"books"</span>&gt;</span>Books<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"movies.html"</span> <span class="attr">data-entry-module</span>=<span class="string">"movies"</span>&gt;</span>Movies<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"video-games.html"</span> <span class="attr">data-entry-module</span>=<span class="string">"video-games"</span>&gt;</span>Video Games<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">main</span>&gt;</span>This is a placeholder for the content that will be loaded on-demand.<span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> main = <span class="built_in">document</span>.querySelector(<span class="string">'main'</span>);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> links = <span class="built_in">document</span>.querySelectorAll(<span class="string">'nav &gt; a'</span>);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">for</span> (<span class="keyword">const</span> link <span class="keyword">of</span> links) &#123;</span></span><br><span class="line"><span class="javascript">    link.addEventListener(<span class="string">'click'</span>, <span class="keyword">async</span> (event) =&gt; &#123;</span></span><br><span class="line"><span class="undefined">      event.preventDefault();</span></span><br><span class="line"><span class="javascript">      <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> <span class="built_in">module</span> = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">`/<span class="subst">$&#123;link.dataset.entryModule&#125;</span>.mjs`</span>);</span></span><br><span class="line"><span class="javascript">        <span class="comment">// The module exports a function named `loadPageInto`.</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">module</span>.loadPageInto(main);</span></span><br><span class="line"><span class="javascript">      &#125; <span class="keyword">catch</span> (error) &#123;</span></span><br><span class="line"><span class="undefined">        main.textContent = error.message;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¯­æ³•æ­£ç¡®ï¼Œé‚£ä¹ˆ <code>import</code> å°†ä¼šå‘æŒ¥å®ƒå¼ºå¤§çš„ä½œç”¨ã€‚</p>
<h2 id="babel-ä¸­çš„-import-syntax"><a href="#babel-ä¸­çš„-import-syntax" class="headerlink" title="babel ä¸­çš„ import syntax"></a>babel ä¸­çš„ import syntax</h2><p><strong>Dynamic</strong> <code>import</code> åœ¨ <a href="https://tc39.github.io/proposal-dynamic-import/#sec-finishdynamicimport" target="_blank" rel="noopener">Stage 3 Draft / November 6, 2017</a> æå‡ºã€‚é‚£ä¹ˆ <em>Babel</em> æ¨èä½¿ç”¨ <a href="https://www.npmjs.com/package/babel-plugin-dynamic-import" target="_blank" rel="noopener">babel-plugin-dynamic-import</a> æ¥å¸®åŠ© <em>Babel</em> è§£ææ­¤è¯­æ³•ã€‚æ­¤æ’ä»¶ä¹Ÿéå¸¸ç®€å•ï¼Œåªæœ‰å¯¥å¯¥æ•°è¡Œä»£ç ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// babel-plugin-syntax-dynamic-import/src/index.js</span></span><br><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"></span><br><span class="line">exports.__esModule = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">exports.default = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    manipulateOptions: <span class="function"><span class="keyword">function</span> <span class="title">manipulateOptions</span>(<span class="params">opts, parserOpts</span>) </span>&#123;</span><br><span class="line">      parserOpts.plugins.push(<span class="string">"dynamicImport"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = exports[<span class="string">"default"</span>];</span><br></pre></td></tr></table></figure>
<p>å®é™…ä¸Šä¹Ÿå°±æ˜¯åœ¨ parse çš„è¿‡ç¨‹ä¸­å¯ç”¨äº†å†…éƒ¨æ’ä»¶ <code>dynamicImport</code>ã€‚é‚£ä¹ˆ <em>babel</em> æ˜¯å¦‚ä½•ä½¿ç”¨æ­¤æ’ä»¶çš„å‘¢ï¼Ÿ<br>æ­¤æ—¶æˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€ä¸‹ babel çš„è¯­æ³•è§£ææœºåˆ¶ã€‚æˆ‘ä»¬çŸ¥é“ <em>babel</em> ä½¿ç”¨ <em>babylon</em> ä½œä¸ºjsè¯­æ³•è§£æçš„å·¥å…·ã€‚é‚£ä¹ˆå¯¹äºæ–°è¯­æ³•çš„æ”¯æŒåº”è¯¥åœ¨ <em>babylon</em> ä¸­å®ç°ã€‚è€Œ <code>import</code> ä½œä¸º <em>esModule</em> ä¸­çš„ä¸€ä¸ªå…³é”®å­—ï¼Œ<em>babylon</em> æ—©å·²æ”¯æŒè§£ææ­¤å…³é”®å­—ï¼Œä½†è¯­æ³•åªæ”¯æŒ <strong>static</strong> <code>import</code> çš„å½¢å¼ã€‚<br>è¿™ä¸ªè§£æè¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œç®€å•æ¥è¯´ï¼š<em>babylon</em> åœ¨è·å–ä¸€ä¸ªå…³é”®å­—åï¼Œä¼šç»§ç»­åˆ†æåç»­çš„è¯­æ³•ã€‚å½“æ‹¿åˆ°äº† <code>preType</code> ä¸ <code>type</code> ä¹‹åï¼Œ<em>babylon</em> å»æ‰¾ç›¸åº”çš„ parse functionï¼Œæ¯”å¦‚å¯¹äº <code>const a = 2</code> è¿™æ ·çš„è¯­å¥ï¼Œ<em>babylon</em> å°±æä¾›äº† <code>parseVarStatement</code> è¿™æ ·çš„å‡½æ•°æ¥è§£æå¹¶ç”Ÿæˆ AST ä¸­çš„ Nodeã€‚åœ¨è¿™æ ·çš„å‡½æ•°ä¸­åŒæ—¶è¿˜ä¼šå†æ¬¡checkä¸€ä¸‹ <code>preType</code> ä¸ <code>type</code>çš„æ­£ç¡®æ€§ã€‚å¦‚æœæ²¡æœ‰ç›¸åº”çš„ parse functionï¼Œæˆ–è€…åœ¨parse functionä¸­å¯¹ type çš„è§£æå‡ºé”™ï¼Œé‚£ä¹ˆbabylonå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>è®²äº†è¿™ä¹ˆå¤šï¼Œæˆ‘ä»¬åœ¨ä»ä»£ç å±‚é¢çœ‹ä¸€ä¸‹ <em>babylon</em> å¯¹äº <strong>Dynamic</strong> <code>import</code> çš„æ”¯æŒã€‚</p>
<h3 id="è§£æè¿‡ç¨‹"><a href="#è§£æè¿‡ç¨‹" class="headerlink" title="è§£æè¿‡ç¨‹"></a>è§£æè¿‡ç¨‹</h3><p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> importPromise = <span class="keyword">import</span>(<span class="string">'./util.js'</span>);</span><br></pre></td></tr></table></figure></p>
<p><strong>è§£æè¿‡ç¨‹(babylon)ï¼š</strong> </p>
<p>é¦–å…ˆï¼Œ <em>Babylon</em> å†…ç½®äº†ä¸€äº›å¸¸é‡ï¼Œå¦‚ keywork mapï¼Œkeyword type mapã€‚ç”¨æ¥åœ¨ä¹‹åçš„ parse è¿‡ç¨‹ä¸­ä½¿ç”¨ã€‚</p>
<ol>
<li>initial Parse Object(ignore fileé…ç½®, pluginé…ç½®, ä¼ å…¥è¦è§£æçš„å­—ç¬¦ä¸²)</li>
<li>ç”ŸæˆASTèŠ‚ç‚¹(File Node, Program Node)</li>
<li>å¼€å§‹è§£æç¨‹åºä¸­çš„ç¬¬ä¸€ä¸ªå…³é”®å­— <a href="https://github.com/babel/babel/blob/master/packages/babylon/src/parser/index.js#L36" target="_blank" rel="noopener">this.nextToken()</a><ul>
<li>ç»è¿‡ä¸€ç³»åˆ—åˆ¤æ–­åï¼ˆæ˜¯å¦éœ€è¦skipSpaceï¼Œæ˜¯å¦å·²ç»å®Œæˆæ‰€æœ‰å­—ç¬¦çš„è§£æï¼Œæ˜¯å¦éœ€è¦overrideï¼‰ï¼Œè°ƒç”¨ <a href="https://github.com/babel/babel/blob/ab7d1231ad6bab4e13199038c58e7ea3ae1e9e27/packages/babylon/src/tokenizer/index.js#L213" target="_blank" rel="noopener">readToken()</a> æ¥å¼€å§‹è§£æå­—ç¬¦</li>
<li>å¯¹ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ASCIIç è¿›è¡Œåˆ¤æ–­æ¥å†³å®šæ˜¯å¦ç»§ç»­è§£æï¼Œå¦‚æœæ˜¯æ­£ç¡®çš„å­—ç¬¦ï¼Œåˆ™è°ƒç”¨  <a href="https://github.com/babel/babel/blob/ab7d1231ad6bab4e13199038c58e7ea3ae1e9e27/packages/babylon/src/tokenizer/index.js#L1297" target="_blank" rel="noopener">readWord</a>æ–¹æ³•æ¥è·å–ç¬¬ä¸€ä¸ªè¯ã€‚</li>
<li>readWord é¦–å…ˆè°ƒç”¨ <a href="https://github.com/babel/babel/blob/ab7d1231ad6bab4e13199038c58e7ea3ae1e9e27/packages/babylon/src/tokenizer/index.js#L1248" target="_blank" rel="noopener">readWord1</a>ã€‚æ­¤æ–¹æ³•æ˜¯åˆ†è¯çš„é‡è¦æ–¹æ³•ã€‚ä½¿ç”¨äº†ä¸€ä¸ª <code>while</code> æ¥è·å–å¹¶è¿”å›ç¬¬ä¸€ä¸ª<strong>éæ­£å¸¸å­—ç¬¦(<a href="https://github.com/babel/babel/blob/ab7d1231ad6bab4e13199038c58e7ea3ae1e9e27/packages/babylon/src/util/identifier.js#L98" target="_blank" rel="noopener">isIdentifierChar()</a>, å¯å¯¹ç…§ ASCII è¡¨è‡ªè¡Œç†è§£)</strong>ä¹‹å‰çš„å•è¯ã€‚æ­¤æ—¶è§£æåè¿”å› <code>const</code> å­—ç¬¦ä¸²ã€‚</li>
<li>readWord æ–¹æ³•åˆ†æ <code>const</code> å­—ç¬¦ä¸²ã€‚å¦‚æœåŒ¹é…å‡ºæ­¤å­—ç¬¦ä¸²ä¸ºå…³é”®è¯ï¼Œåˆ™ <strong>æ›´æ–°è§£æå™¨çš„çŠ¶æ€</strong> çš„ type ä¸º constTypeï¼Œç„¶åè°ƒç”¨ <a href="https://github.com/babel/babel/blob/ab7d1231ad6bab4e13199038c58e7ea3ae1e9e27/packages/babylon/src/tokenizer/index.js#L388" target="_blank" rel="noopener">finishToken</a></li>
<li>finishToken æ–¹æ³• <strong>æ›´æ–°è§£æå™¨çš„çŠ¶æ€</strong> çš„ pos(position) ä¸ºå½“å‰å·²ç»è§£æåˆ°çš„posã€‚ç„¶åè°ƒç”¨ updateContext çœ‹æ˜¯å¦éœ€è¦ç”¨å½“å‰çš„ type æ¥æ›´æ–°ä¹‹å‰çš„ preTypeã€‚æ­¤æ—¶ï¼Œæ•´ä¸ª nextToken è°ƒç”¨æ ˆå…¨éƒ¨å®Œæˆ</li>
</ul>
</li>
<li>è°ƒç”¨ <a href="https://github.com/babel/babel/blob/ab7d1231ad6bab4e13199038c58e7ea3ae1e9e27/packages/babylon/src/parser/index.js#L37" target="_blank" rel="noopener">parseTopLevel</a> æ¥å¼€å§‹æ•´ä¸ªç¨‹åºçš„è§£æ<ul>
<li>è°ƒç”¨ parseBlockBody æ¥è§£ææ¥ä¸‹æ¥çš„ä»£ç ã€‚å¦‚æœå½“å‰çš„ type ä¸æ˜¯ eofï¼Œåˆ™è°ƒç”¨ <a href="https://github.com/babel/babel/blob/f0d681a238d1d80fc7ca3a1bbcfd4d3d03f5c12f/packages/babylon/src/parser/statement.js#L67" target="_blank" rel="noopener">parseStatement</a></li>
<li>æ­¤æ–¹æ³•åˆ†æ <strong>è§£æå™¨çŠ¶æ€</strong> ä¸­çš„ typeï¼Œæ ¹æ®ä¸åŒçš„ type æ¥è°ƒç”¨ä¸åŒçš„è§£æå‡½æ•°ã€‚åœ¨ <em>babylon</em> ä¸­ï¼Œ<code>var let const</code> å‡è°ƒç”¨ <a href="https://github.com/babel/babel/blob/f0d681a238d1d80fc7ca3a1bbcfd4d3d03f5c12f/packages/babylon/src/parser/statement.js#L547" target="_blank" rel="noopener">parseVarStatement</a>ã€‚</li>
<li>parseVarStatement é¦–å…ˆè°ƒç”¨ <code>this.next()</code> æ–¹æ³•æ¥æ‹¿åˆ°åç»­çš„ä»£ç (å˜é‡å)ã€‚ <code>this.next()</code> æ–¹æ³•ä¼šå†æ¬¡è°ƒç”¨ <code>nextToken()</code> æ¥è·å–åé¢çš„å­—ç¬¦ä¸²å¹¶è¿›è¡Œè§£æã€‚ä¹Ÿå°±æ˜¯é‡å¤ç¬¬ä¸‰ä¸ªæ­¥éª¤ã€‚æ‹¿åˆ°äº†ä¹‹åï¼Œè°ƒç”¨ <code>parseVarHead -&gt; parseBindingAtom -&gt; parseIdentifier</code> æ¥ç”Ÿæˆ <code>VarStatement Node</code>ä¸­çš„ <code>Identifier Node</code>ï¼ŒåŒæ—¶å†æ¬¡è°ƒç”¨ <code>this.next()</code> æ–¹æ³•æ¥è·å–ä¸‹ä¸€ä¸ªæ ‡è¯†ç¬¦</li>
<li>æ‹¿åˆ°ä¸‹ä¸€ä¸ªæ ‡è¯†ç¬¦åï¼Œå¯¹æ­¤æ ‡è¯†ç¬¦è¿›è¡Œåˆ†æï¼Œå¦‚æœæ˜¯ <code>=</code>, åˆ™ <strong>å†æ¬¡</strong> è°ƒç”¨ <code>this.next()</code>(æ­¤æ—¶æ˜¯ä½¿ç”¨ <a href="https://github.com/babel/babel/blob/f0d681a238d1d80fc7ca3a1bbcfd4d3d03f5c12f/packages/babylon/src/parser/statement.js#L770" target="_blank" rel="noopener">this.eat()</a> æ–¹æ³•æ¥ç¡®è®¤æ˜¯å¦éœ€è¦è°ƒç”¨) æ¥è·å–ä¸‹ä¸€ä¸ªæ ‡è¯†ç¬¦(ä¹Ÿå°±æ˜¯è¦èµ‹äºˆ importPromise çš„å€¼)ï¼Œæ­¤æ—¶å†æ¬¡é‡å¤ç¬¬ä¸‰ä¸ªæ­¥éª¤</li>
<li>å®Œæˆä¸Šä¸€æ­¥åï¼Œæ­¤æ—¶ <strong>è§£æå™¨çŠ¶æ€</strong> çš„ value ä¸º <code>&#39;import&#39;</code>, åŒæ—¶ import ä½œä¸ºå…³é”®è¯ä¹Ÿæœ‰ä»–çš„ç±»å‹ï¼Œå› æ­¤æ­¤æ—¶æ­¤æ—¶ <strong>è§£æå™¨çŠ¶æ€</strong> çš„ type ä¸º <code>KeywordTokenType</code>ã€‚ æ­¤æ—¶è°ƒç”¨ <code>this.parseMaybeAssign()</code> æ¥åšä¸‹ä¸€æ­¥å¤„ç†ã€‚</li>
<li>æ­¤æ—¶è¿›å…¥ <code>this.parseMaybeAssign()</code> å‡½æ•°ã€‚å› ä¸ºå¯¹å˜é‡çš„èµ‹å€¼å¯èƒ½ä¼šæœ‰å¾ˆå¤šç§æƒ…å†µï¼Œå¦‚ <code>var a = () =&gt; {}</code>, <code>var a = true ? 0 : 1</code>, <code>var a = await xxx</code>ç­‰ç­‰ï¼Œæ‰€ä»¥æ­¤å‡½æ•°çš„è°ƒç”¨æ ˆè¾ƒé•¿ï¼Œå¯¹äºå¤„ç†æˆ‘ä»¬çš„caseæ¥è¯´ï¼Œè°ƒç”¨æ ˆä¸º <code>parseMaybeAssign -&gt; parseMaybeConditional -&gt; parseExprOps -&gt; parseMaybeUnary -&gt; parseExprSubscripts -&gt; parseExprAtom</code>ã€‚åœ¨ <code>parseExprAtom</code> å‡½æ•°ä¸­ï¼Œä¼šé’ˆå¯¹å½“å‰<strong>è§£æå™¨çŠ¶æ€</strong> çš„ type æ¥æ‰§è¡Œä¸åŒçš„æ–¹æ³•ã€‚æ­¤æ—¶å‡½æ•°æ‰§è¡Œåˆ° <a href="https://github.com/babel/babel/blob/ab7d1231ad6bab4e13199038c58e7ea3ae1e9e27/packages/babylon/src/parser/expression.js#L732" target="_blank" rel="noopener">case types._import</a> å¤„ã€‚</li>
<li>æ­¤æ—¶ä¼šå¯¹ Parser çš„æ’ä»¶é…ç½®åšåˆ¤æ–­ï¼Œè¯´æ˜¯æ’ä»¶ï¼Œå…¶å®å°±æ˜¯ <em>babylon</em> é¢„è®¾çš„ä¸€äº›åŠŸèƒ½ã€‚å¦‚æœæœªå¯ç”¨ <code>DynamicImport</code>ï¼Œbabylonå°±ä¼šæŠ¥ Unexpected token çš„é”™è¯¯ã€‚å¦‚æœå¯ç”¨äº†ï¼Œåˆ™ä¼šè°ƒç”¨ this.next() æ¥ç»§ç»­è§£æåé¢çš„å­—ç¬¦ï¼Œç›´åˆ°ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„ <strong>Import èŠ‚ç‚¹</strong>ã€‚</li>
<li>ä¸Šä¸€æ­¥æ­¥æ‰§è¡Œå®Œæˆåï¼Œå›åˆ° <code>parseMaybeAssign</code> å‡½æ•°ï¼Œæ­¤å‡½æ•°è¿”å› Import Nodeã€‚ å›åˆ° parseVar å‡½æ•°ï¼Œå°†æœªå®Œæˆçš„ Identifier èŠ‚ç‚¹çš„initçš„å€¼è®¾ä¸ºImport Nodeã€‚åŒæ—¶æ‰§è¡Œ <code>this.finishNode</code> å‡½æ•°è¡¨ç¤ºæ­¤ Identifier èŠ‚ç‚¹å·²ç»å…¨éƒ¨ç”ŸæˆæˆåŠŸã€‚ å›åˆ° <code>parseVarStatement</code> å‡½æ•°ï¼Œå†æ¬¡æ‰§è¡Œ <code>this.finishNode</code> è¡¨ç¤º VariableDeclaration èŠ‚ç‚¹ä¹Ÿå·²ç»å…¨éƒ¨å¤„ç†å®Œæˆ</li>
</ul>
</li>
<li>è‡³æ­¤ï¼Œè§£æè¿‡ç¨‹å…¨éƒ¨å®Œæˆã€‚å›åˆ°æœ€åˆçš„ <code>parseTopLevel</code> å‡½æ•°ï¼Œé€šè¿‡æ‰§è¡Œ <code>file.program = this.finishNode(program, &quot;Program&quot;);</code>, <code>return this.finishNode(file, &quot;File&quot;);</code> åï¼Œæˆ‘ä»¬ç»ˆäºå®Œæˆäº†ä»£ç çš„è§£æï¼Œå¹¶å¾—åˆ°äº†æˆ‘ä»¬ä»£ç çš„ASTè¯­æ³•æ ‘ã€‚</li>
</ol>
<p>å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ <em>babylon</em> è§£æä»£ç çš„è¿‡ç¨‹ç®€å•ç†è§£ä¸ºï¼šæå–å…³é”®å­— -&gt; ç»§ç»­è§£æåé¢çš„ä»£ç ç›´åˆ°èƒ½å®Œæ•´çš„ç”Ÿæˆä¹‹å‰å…³é”®å­—çš„ASTèŠ‚ç‚¹ -&gt; è°ƒç”¨äº†finishTokenï¼Œç„¶åç»§ç»­ç”Ÿæˆä¸‹ä¸€ä¸ªèŠ‚ç‚¹ -&gt; è§£æåˆ°æ–‡ä»¶ç»“å°¾ï¼Œç»“æŸ è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ã€‚ é‡ç‚¹çš„è¿‡ç¨‹å°±æ˜¯åœ¨è§£æåˆ°ä¸€ä¸ªkeywordä¹‹åå¯¹åé¢å­—ç¬¦çš„è§£æã€‚<em>babylon</em> å¯¹ç‰¹å®šçš„è¯­æ³•éƒ½æœ‰ç›¸å…³çš„å‡½æ•°æ¥å®Œæˆæ¥ä¸‹æ¥çš„è§£æï¼Œå¦‚ <code>parseVarStatement</code>, <code>parseIfStatement</code> ç­‰ç­‰ã€‚æ¯ä¸€ä¸ª keyword å¯¹åº”çš„è§£æå‡½æ•°ï¼Œéƒ½å¯¹æ¥ä¸‹æ¥çš„ è§£æåˆ°çš„ <em>å•è¯ or å­—ç¬¦</em> éƒ½æœ‰ç›¸åº”çš„æœŸæœ›å€¼ï¼Œ<em>babylon</em> ä¼šåœ¨æ­¤å¤„æ¥å†³å®šæ˜¯ç»§ç»­è§£ææ¥å®Œæˆå½“å‰èŠ‚ç‚¹çš„æ¸²æŸ“è¿˜æ˜¯æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<h2 id="åè¯"><a href="#åè¯" class="headerlink" title="åè¯"></a>åè¯</h2><p>ä½œè€…æœ¬æ¥åœ¨ä½¿ç”¨ <a href="https://github.com/faceyspacey/react-universal-component" target="_blank" rel="noopener">react-universal-component</a> å‡ºç°äº†é—®é¢˜æ— æ³•è§£å†³ï¼Œé‚æ‰“ç®—è‡ªå·±å®ç°ä¸€ä¸‹è¿™ç§ componentï¼Œæ²¡æƒ³åˆ°ç«Ÿç„¶èµ°åˆ°äº†è¿™ä¸ªåœ°æ–¹ã€‚ã€‚<br>æœ¬æ–‡å¯¹äº <em>babylon</em> çš„è§£æè¿‡ç¨‹çš„è§£é‡Šè¿˜æ˜¯å¿½ç•¥äº†å¾ˆå¤šç»†èŠ‚çš„æˆåˆ†ï¼ŒåŒæ—¶ä¹Ÿä»…ä»…å¯¹ å˜é‡å£°æ˜ è¿™ä¸ªcaseåšäº†åˆ†æã€‚å¹¶ä¸”ï¼Œå¯¹äºè‡ªå®šä¹‰çš„ babel plugin çš„ä½¿ç”¨åœºæ™¯è¿˜æœªåšåˆ†æï¼Œè€Œä»…ä»…åˆ†æäº†å†…ç½®çš„ plugin çš„ä½¿ç”¨åœºæ™¯ã€‚ä½†å®é™…ä¸Š <em>babylon</em> çš„æ ¸å¿ƒä¹Ÿå°±æ˜¯è¿™äº›ä¸œè¥¿ã€‚é€šè¿‡ç†è§£è¿™æ ·ä¸€ä¸ªç”Ÿæˆ AST çš„è¿‡ç¨‹ï¼Œä»¥åä¹Ÿå¯ä»¥å°è¯•ç€å†™ä¸€ä¸ªè‡ªå·±çš„ js parserã€‚æ¯•ç«Ÿ ECMA  ä¹Ÿåªæ˜¯çº¦å®šäº†è¯­æ³•è§„èŒƒè€Œæ²¡æœ‰çº¦å®š AST çš„è§„èŒƒã€‚</p>
<p><em>TO BE CONTINUE</em></p>
<p><a href="https://tc39.github.io/proposal-dynamic-import" target="_blank" rel="noopener">tc39/proposal-dynamic-import</a><br><a href="https://developers.google.com/web/updates/2017/11/dynamic-import" target="_blank" rel="noopener">google/dynamic-import</a><br><a href="https://medium.com/@WebReflection/javascript-dynamic-import-export-b0e8775a59d4" target="_blank" rel="noopener">medium/dynamic-import</a></p>

            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="pagination" role="pagination">
    
        <a class="pull-left" href="/2018/03/29/understand-visitor-pattern-in-javascript/" style="float: left;">ä¸Šä¸€ç¯‡: å­¦ä¹ è®¿é—®è€…æ¨¡å¼</a>
    
    
        <a class="pull-right" href="/2017/01/27/webpack2/">ä¸‹ä¸€ç¯‡: ä½¿ç”¨webpack+express+typescript+reactæ­å»ºå‰ç«¯æ¡†æ¶(ä¸‰):Express æœåŠ¡ç«¯é…ç½®</a>
    
</nav>

        <div class="duoshuo">


</div>
    </div>
</section>

      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By MrKou47. All Rights Reserved.
                </p>
                <p>Theme By <a href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
                <!-- <p><a href="http://www.miitbeian.gov.cn/" style="color: #767D84">å†€ICPå¤‡17019050å·</a></p> -->
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/MrKou47" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://twitter.com/mrkou47" title="Twitter" target="_blank"><i class="icon-twitter"></i></a>&nbsp;</li>
                    
                    
                    
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };

    resizeHero();

    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/jquery.flexslider-min.js" defer="defer"></script><!-- Flexslider plugin -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$('#intro').find('img').each(function(){
  var alt = this.alt;

  if (alt){
    $(this).after('<span class="caption" style="display:none">' + alt + '</span>');
  }

  $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="gallery" />');
});
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

<!-- Initiate flexslider plugin -->
<script type="text/javascript">
    $(document).ready(function($) {
      (function(){
        var getCss = function(path) {
          var head = document.getElementsByTagName('head')[0];
          link = document.createElement('link');
          link.href = path;
          link.rel = 'stylesheet';
          link.type = 'text/css';
          head.appendChild(link);
        };
        getCss('https://fonts.googleapis.com/css?family=Montserrat:400,700');
        getCss('https://fonts.googleapis.com/css?family=Open+Sans:400,600');
      })();
      $('.flexslider').flexslider({
        animation: "fade",
        prevText: "",
        nextText: "",
        directionNav: true
      });
    });
</script>

</body>
</html>
